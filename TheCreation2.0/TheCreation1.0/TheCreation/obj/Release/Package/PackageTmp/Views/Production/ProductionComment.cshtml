@using Models
@model IEnumerable<Models.Comments>
@{
    Layout = null;
}
<!--评论区-->
<div class="bcmtlst">
    <ul class="clearfix ztag">
        @foreach (Comments item in Model)
        {
            <li class="s-bd2 s-bg2">
                <div class="bcmtlsta clearfix">
                    <div class="bcmtlstb">
                        <a href="#" target="_top" title="@item.Users.UsersName - @item.CommentDate"><img class="itag" src="@item.Users.HeadUrl" style="border-radius:50%;"></a>
                    </div>
                    <div class="bcmtlstc">
                        <div class="bcmtlstd clearfix">
                            <div class="bcmtlste clearfix">
                                <div class="bcmtlstg">
                                    <div class="bcmtlsti">
                                        <div class="bcmtlstj">
                                            <a class="s-fc2 itag bcmtlstk" href="#" target="_top" title="@item.Users.UsersName - @item.CommentDate">@item.Users.UsersName</a>
                                            <br />
                                            <span class="bcmtlstf s-fc2 itag">@item.CommentContent</span>
                                            <div class="bcmtlsth">
                                                @using (Ajax.BeginForm("AddReply", "Production", new AjaxOptions { HttpMethod = "post", OnSuccess = "addreply", UpdateTargetId = "Div2" }))
                                                {
                                                    @Html.AntiForgeryToken()
                                                    @Html.ValidationSummary(true)
                                                    <a class="reply-btn" onclick="on(@item.CommentId)" ondblclick="down(@item.CommentId)" id="reply" style="float:right">回复</a>
                                                    <div id="content" style="display:none">
                                                        <input class="form-control" type="hidden" id="cid" name="cid" value="@item.CommentId" />
                                                        <textarea placeholder="来说几句吧......" class="mytextarea" id="reply-content" name="rcontent" style="width:300px;height:30px"></textarea>
                                                        <span id="tips"></span>
                                                        <button type="submit" class="reply-btn" id="btn-reply">确认回复</button>
                                                    </div>
                                                }
                                            </div>

                                            <div id="Div2">
                                                @*@{Html.RenderAction("AddReply", "Production");}*@
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-end" style="font-size:12px;float:right">
                                    <span>@item.CommentDate</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </li>

        }

    </ul>
</div>

<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>
<script src="~/Scripts/jquery.comment.js"></script>
<script type="text/javascript">

    function on() {
        var arr = document.getElementById("content");
        arr.style.display = "block";
    }
    function down() {
        var brr = docu.getElementById("content");
        brr.style.display = "none";
    }

    $('#btn-reply').on('click', function () {
        /*var content = $('#reply-content').val();*/
        if ($('#reply-content').val().length == 0) {
            $('.tips').html('请输入回复内容！');
        } else {
            $.ajax({
                url: "/Production/AddReply",
                type: "post",
                data: {
                    cid: $('#cid').val(),
                    rcontent: $('#reply-content').val()
                },
                success: function (data) {
                    if (data == "success") {
                        if (history.length > 1) {
                            alert("回复成功！")

                        }
                        else {
                            window.location.href = '未登录';
                        }
                        window.location.href = '未登录';
                    }
                    else {
                        $('.tips').html('回复不能提交空内容！');

                    }
                }
            });
        }
    });
</script>

<!--加载-->
<li id="notes_loading_50" style="display:none;text-align:center;" class="note">
    <span>加载中...</span>
</li>
<li id="more_notes_50" style="text-align:center;" class="note more_notes_link_container">
    <a onclick="load_more_notes(event,7697651395,50)" href="#" class="more_notes_link">查看更多</a>
</li>
