@using Models
@model Users
@{
    Layout = null;
}

<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="~/layui/css/layui.css" rel="stylesheet" />
    <title>创世界个人中心</title>
</head>
<body class="layui-layout-body container">
    <div class="layui-layout layui-layout-admin">
        <div class="layui-header" style="background-color: #20222A">
            <div class="layui-logo" style="background-color: #393D49;color: white;height: 210px;border-bottom: 1px solid white">
                <div style="background-color: #393D49;color: #009E94;font-weight: bolder">创世界</div>
                <a href="#" id="tip" onmouseenter="tip()">
                    <img id="userImg" src="@Model.HeadUrl" style="width: 90px;height: 90px" class="layui-nav-img">
                </a>
                <div style="font-size: 10px;text-align: center;height: 15px;margin-bottom: 8px;padding-right: 6px">
                    @Model.UsersName
                </div>
                <div style="font-size: 10px;padding-right: 10px">
                    您好，欢迎登录创世界
                </div>
            </div>

            <ul class="layui-nav layui-layout-right">
                <li class="layui-nav-item"><a href="@Url.Action("Home","Home")" onclick="clearCookie()" id="logout">返回首页</a></li>
                <li class="layui-nav-item">
                    <a href="@Url.Action("PersonalCenter","UserManage")" id="refresh">
                        <i class="layui-icon layui-icon-refresh"></i>
                    </a>
                </li>
                <li class="layui-nav-item" id="time" style="margin-right: 50px;font-size: 16px;color: #2fb9d4;position: absolute;left: -250px;top: 0">2021-03-21&nbsp;&nbsp;星期日&nbsp;&nbsp;21:39:04</li>
                <li class="layui-nav-item">
                    <a href="javascript:;">
                        <img src="@Model.HeadUrl" class="layui-nav-img">
                        <span>@Model.UsersName</span>
                    </a>
                    <dl class="layui-nav-child">
                        <dd>
                            <a href="#" data-url="@Url.Action("Baseinfo","PersonalSpace",Model)" data-id="13" data-title="基本信息" class="site-demo-active">
                                <i class="layui-icon layui-icon-user"></i>
                                基本信息
                            </a>
                        </dd>
                        <dd>
                            <a href="#" data-url="@Url.Action("AlterPwords","PersonalSpace")" data-id="14" data-title="修改密码" class="site-demo-active">
                                <i class="layui-icon layui-icon-set"></i>
                                修改密码
                            </a>
                        </dd>
                    </dl>
                </li>
                <li class="layui-nav-item"><a href="@Url.Action("Logout","Home")" onclick="clearCookie()" id="logout"><i class="layui-icon layui-icon-logout"></i>退出</a></li>
            </ul>
        </div>

        <div class="layui-side layui-bg-black" style="padding-top: 150px">
            <div class="layui-side-scroll">
                <ul class="layui-nav layui-nav-tree" lay-filter="test">
                    <li class="layui-nav-item" id="userManage" style="text-align: center">
                        <a href="#" data-url="@Url.Action("Baseinfo","PersonalSpace")" data-id="1" data-title="基本信息" class="site-demo-active" data-type="tabAdd">
                            <i class="layui-icon layui-icon-user"></i>基本信息
                        </a>
                    </li>
                    <li class="layui-nav-item" id="dept" style="text-align: center">
                        <a href="#" data-url="@Url.Action("AlterPwords","PersonalSpace")" data-id="2" data-title="修改密码" class="site-demo-active" data-type="tabAdd">
                            <i class="layui-icon layui-icon-chart-screen"></i> 修改密码
                        </a>
                    </li>
                    <li class="layui-nav-item" id="message" style="text-align: center">
                        <a href="#" data-url="@Url.Action("AllMessageManage","PersonalSpace")" data-id="3" data-title="消息中心" class="site-demo-active" data-type="tabAdd">
                            <i class="layui-icon layui-icon-survey"></i> 消息中心
                        </a>
                    </li>
                    <li class="layui-nav-item" id="student" style="text-align: center">
                        <a href="#" data-url="@Url.Action("WorksManage","PersonalSpace")" data-id="4" data-title="创作品管理" class="site-demo-active" data-type="tabAdd">
                            <i class="layui-icon layui-icon-user"></i> 创作品管理
                        </a>
                    </li>
                    <li class="layui-nav-item" id="dept" style="text-align: center">
                        <a href="#" data-url="@Url.Action("OrdersManage","PersonalSpace")" data-id="5" data-title="订单记录" class="site-demo-active" data-type="tabAdd">
                            <i class="layui-icon layui-icon-chart-screen"></i> 订单记录
                        </a>
                    </li>
                    @{
                        if (Model.CreatorId != null)
                        {
                            <li class="layui-nav-item" style="text-align: center">
                                <a href="javascript:;"><i class="layui-icon layui-icon-username"></i>创作者管理</a>
                                <dl class="layui-nav-child">
                                    <dd>
                                        <a href="#" data-url="@Url.Action("AuthorManage","PersonalSpace")" data-id="6" data-title="创作者信息" class="site-demo-active">
                                            <i class="layui-icon layui-icon-table"></i> 创作者信息
                                        </a>
                                    </dd>
                                    <dd>
                                        <a href="#" data-url="@Url.Action("AuthorOrdersManage","PersonalSpace")" data-id="7" data-title="创作者订单" class="site-demo-active">
                                            <i class="layui-icon layui-icon-table"></i> 创作者订单
                                        </a>
                                    </dd>
                                </dl>
                            </li>
                        }
                    }

                </ul>
            </div>
        </div>

        <!--tab标签-->
        <div class="layui-tab" lay-filter="demo" lay-allowclose="true" style="margin-left: 200px;">
            <ul class="layui-tab-title"></ul>
            <div class="layui-tab-content"></div>
            <div class="layui-footer" style="text-align:center;">
                <!-- 底部固定区域 -->
                © The Creation
            </div>
        </div>
    </div>
    <script src="~/layui/layui.js"></script>
    <script src="~/Scripts/个人空间/jquery.min.js"></script>
    <script>
        layui.use(['element', 'layer', 'jquery'], function () {
            var element = layui.element;
            var $ = layui.$;
            // 配置tab实践在下面无法获取到菜单元素
            $('.site-demo-active').on('click', function () {
                var dataid = $(this);
                //这时会判断右侧.layui-tab-title属性下的有lay-id属性的li的数目，即已经打开的tab项数目
                if ($(".layui-tab-title li[lay-id]").length <= 0) {
                    //如果比零小，则直接打开新的tab项
                    active.tabAdd(dataid.attr("data-url"), dataid.attr("data-id"), dataid.attr("data-title"));
                } else {
                    //否则判断该tab项是否以及存在
                    var isData = false; //初始化一个标志，为false说明未打开该tab项 为true则说明已有
                    $.each($(".layui-tab-title li[lay-id]"), function () {
                        //如果点击左侧菜单栏所传入的id 在右侧tab项中的lay-id属性可以找到，则说明该tab项已经打开
                        if ($(this).attr("lay-id") == dataid.attr("data-id")) {
                            isData = true;
                        }
                    })
                    if (isData == false) {
                        //标志为false 新增一个tab项
                        active.tabAdd(dataid.attr("data-url"), dataid.attr("data-id"), dataid.attr("data-title"));
                    }
                }
                //最后不管是否新增tab，最后都转到要打开的选项页面上
                active.tabChange(dataid.attr("data-id"));
            });

            var active = {
                //在这里给active绑定几项事件，后面可通过active调用这些事件
                tabAdd: function (url, id, name) {
                    //新增一个Tab项 传入三个参数，分别对应其标题，tab页面的地址，还有一个规定的id，是标签中data-id的属性值
                    //关于tabAdd的方法所传入的参数可看layui的开发文档中基础方法部分
                    element.tabAdd('demo', {
                        title: name,
                        content: '<iframe data-frameid="' + id + '" scrolling="auto" frameborder="0" src="' + url +
                            '" style="width:100%;height:99%;"></iframe>',
                        id: id //规定好的id
                    })
                    FrameWH(); //计算ifram层的大小
                },
                tabChange: function (id) {
                    //切换到指定Tab项
                    element.tabChange('demo', id); //根据传入的id传入到指定的tab项
                },
                tabDelete: function (id) {
                    element.tabDelete("demo", id); //删除
                }
            };

            function FrameWH() {
                var h = $(window).height();
                $("iframe").css("height", h + "px");
            }
        });
    </script>
    <script>
        //顶部时间
        function getTime() {
            var myDate = new Date();
            var myYear = myDate.getFullYear(); //获取完整的年份(4位,1970-????)
            var myMonth = myDate.getMonth() + 1; //获取当前月份(0-11,0代表1月)
            var myToday = myDate.getDate(); //获取当前日(1-31)
            var myDay = myDate.getDay(); //获取当前星期X(0-6,0代表星期天)
            var myHour = myDate.getHours(); //获取当前小时数(0-23)
            var myMinute = myDate.getMinutes(); //获取当前分钟数(0-59)
            var mySecond = myDate.getSeconds(); //获取当前秒数(0-59)
            var week = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
            var nowTime;

            nowTime = myYear + '-' + fillZero(myMonth) + '-' + fillZero(myToday) + '&nbsp;&nbsp;' + week[myDay] +
                '&nbsp;&nbsp;' + fillZero(myHour) + ':' + fillZero(myMinute) + ':' + fillZero(mySecond);
            //console.log(nowTime);
            $('#time').html(nowTime);
        };

        function fillZero(str) {
            var realNum;
            if (str < 10) {
                realNum = '0' + str;
            } else {
                realNum = str;
            }
            return realNum;
        }
        setInterval(getTime, 1000);
    </script>
</body>

</html>
