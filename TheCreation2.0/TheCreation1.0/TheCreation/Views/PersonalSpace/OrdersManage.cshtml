@using Models
@model TheCreation.Models.UserOrdersViewModel
@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1, shrink-to-fit=no">
    <title>Title</title>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-3.5.1.min.js"></script>
    <script src="~/bootstrap-4.5.0-dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/bootstrap-4.5.0-dist/js/bootstrap.min.js"></script>
    <style>
        .custom .active {
            border-radius: 0 !important;
            background: #00cc99 !important;
        }

        .color1 {
            color: #FF4466;
        }

        .color2 {
            color: #ff9797;
        }

        .value {
            font-size: 0.8rem;
        }

        .time {
            font-size: 14px;
            font-weight: 400;
            color: dimgrey;
        }

        .state {
            color: grey;
            font-size: 15px;
        }
    </style>
</head>
<body class="container mb-5">
    <div class="mt-5"></div>
    @*<a href="#">
            <h4>查看历史订单记录</h4>
        </a>
        <a href="#">
            <h4>待验收订单</h4>
        </a>*@
    <ul class="nav nav-pills d-flex custom mt-4">
        <li class="nav-item border flex-fill text-center">
            <a class="nav-link active" data-toggle="tab" href="#image1">全部订单</a>
        </li>
        <li class="nav-item border flex-fill text-center">
            <a class="nav-link" data-toggle="tab" href="#image2">未被接受</a>
        </li>
        <li class="nav-item border flex-fill text-center">
            <a class="nav-link" data-toggle="tab" href="#image3">待评价</a>
        </li>
        <li class="nav-item border flex-fill text-center">
            <a class="nav-link" data-toggle="tab" href="#image4">进行中</a>
        </li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane fade show active" id="image1">
            @*全部订单*@
            @foreach (var item in Model.All_User_Orders)
            {
                <div class="row h-100 no-gutters border-bottom justify-content-between mt-2" style="height: 200px; ">
                    <div class="col-3">
                        <div class="img p-4" style="display:flex;position: center;">
                            <img src="~/image/PersonalSpace/图片二.jpg" width="100%" style="border-radius: 5%;" />
                        </div>
                        <div class="text-center mt-n1 state">@item.OrderState</div>
                    </div>
                    <div class="col-6 py-3">
                        <p>@item.Name</p>
                        <div class="time" style="margin-bottom: 8px;">消费时间：@item.BuyDate</div>
                        <div class="time" style="margin-bottom:10px;">交付时间：@item.FinishDate</div>
                        <span>@item.Creator.CreateType</span>&nbsp;&nbsp;
                        <span>接单人：@item.Creator.Users.UsersName</span><br>
                        <div class="mt-2"></div>
                        <button data-toggle="modal" data-target="@string.Format("#ModelA1{0}",item.OrderId).Trim()" type="button" class="btn btn-info">查看订单</button>
                        <button data-toggle="modal" data-target="@string.Format("#ModelA2{0}",item.OrderId).Trim()" type="button" class="btn btn-info">再来一单</button>
                    </div>
                    <div class="col-2 py-4" style="color: red;">
                        ￥@item.total_amt
                    </div>
                </div>

                //查看订单模态框
                <div class="modal fade" id="@string.Format("ModelA1{0}",item.OrderId).Trim()">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalTitle">订单信息</h5>
                                <button type="button" class="close" data-dismiss="modal">
                                    <span>&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div>订单名：@item.Name</div><br />
                                <div>下单人：@item.Users.UsersName</div><br />
                                <div>接单人：@item.Creator.Users.UsersName</div><br />
                                <div>金额：@item.total_amt</div><br />
                                <div>下单日期：@item.BuyDate</div><br />
                                <div>截止日期：@item.FinishDate</div><br />
                                <div>订单状态：@item.OrderState</div><br />
                                <div>具体描述：<br /><textarea rows="5" cols="45">@item.NeedDescrib</textarea></div>

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                            </div>
                        </div>
                    </div>
                </div>

                // 提交订单(再来一单)的模态框
                <div class="modal fade" id="@string.Format("ModelA2{0}",item.OrderId).Trim()">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalTitle">请他定制</h5>
                                <button type="button" class="close" data-dismiss="modal">
                                    <span>&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                @using (Html.BeginForm("SendOrder", "OrderManage", new { name = "form2" }))
                                {
                                    @Html.AntiForgeryToken()
                                    <p>请在下方输入你的需求(该内容作为后期申诉参考，请认真填写)</p><textarea rows="5" cols="45" name="need" placeholder="请在此输入您的需求"> </textarea>
                                    <input type="hidden" name="creatorid" value="@item.CreatorId" />
                                    <P>给订单取个名字吧</P>
                                    <input type="text" name="name" /><br />
                                    <span>交付日期：</span> <input type="date" name="finishdate"><br />
                                    <input type="text" placeholder="价格介于 @item.Creator.PriceRange 之间" name="price" /><br /><br />
                                    <button style="width:50px;height:34px;line-height:30px;background-color:#55557f;color: #fff;text-align:center;" type="button" data-dismiss="modal">关闭</button>
                                    <button style="width:150px;height:34px;line-height:30px;background-color:#55557f;color: #fff;text-align:center;" type="submit" formmethod="post">付款并提交</button>
                                }
                            </div>
                            <div class="modal-footer">

                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
        <div class="tab-pane fade" id="image2">
            @*未被接受*@
            @foreach (var item in Model.UnAccepted_User_Orders)
            {
                <div class="row h-100 no-gutters border-bottom justify-content-between mt-2" style="height: 200px; ">
                    <div class="col-3">
                        <div class="img p-4" style="display:flex;position:center;">
                            <img src="~/image/PersonalSpace/图片五.jpg" width="100%" style="border-radius: 5%;" />
                        </div>
                        <div class="text-center mt-n1 state">@item.OrderState</div>
                    </div>
                    <div class="col-6 py-3">
                        <p>@item.Name</p>
                        <div class="time" style="margin-bottom: 8px;">消费时间：@item.BuyDate</div>
                        <div class="time" style="margin-bottom:10px;">交付时间：@item.FinishDate</div>
                        <span>@item.Creator.CreateType</span>&nbsp;&nbsp;
                        <span>接单人：@item.Creator.Users.UsersName</span><br>
                        <div class="mt-2"></div>
                        <button data-toggle="modal" data-target="@string.Format("#ModelB1{0}",item.OrderId).Trim()" type="button" class="btn btn-info">修改订单</button>
                        <button type="button" data-toggle="modal" data-target="@string.Format("#ModelB2{0}",item.OrderId).Trim()" class="btn btn-info">查看订单</button>
                        <a href="@Url.Action("UrgenOrder","OrderManage",new { id=item.OrderId})" type="button" class="btn btn-info">催促接单</a>
                        <a href="@Url.Action("BackOrder","OrderManage",new { id=item.OrderId})" onclick="if (confirm('是否确认撤销订单？') == false) return false;" type="button" class="btn btn-info">撤销订单</a>
                    </div>
                    <div class="col-2 py-4" style="color: red;">
                        ￥@item.total_amt
                    </div>
                </div>


                // 修改订单的模态框
                <div class="modal fade show" id="@string.Format("ModelB1{0}",item.OrderId).Trim()">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalTitle">请他定制</h5>
                                <button type="button" class="close" data-dismiss="modal">
                                    <span>&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                @using (Html.BeginForm("AlterOrder", "OrderManage", new { name = "form2" }))
                                {
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="orderid" value="@item.OrderId" />
                                    <p>请在下方输入你的需求(该内容作为后期申诉参考，请认真填写)</p><textarea rows="5" cols="45" name="need" id="@string.Format("valueZ{0}",item.OrderId).Trim()" placeholder="请在此输入您的需求"> </textarea>
                                    <P>订单名称</P>
                                    <input type="text" value="@item.Name" name="name" /><br />
                                    <span>交付日期：</span> <input type="date" value="@item.FinishDate" name="finishdate"><br />
                                    <br />
                                    <button type="button" data-dismiss="modal">关闭</button>
                                    <button type="submit" formmethod="post">确认修改</button>
                                }
                            </div>
                            <div class="modal-footer">

                            </div>
                        </div>
                    </div>
                </div>
                <script>
                    document.getElementById("@string.Format("valueZ{0}", item.OrderId).Trim()").value="@item.NeedDescrib"
                </script>

                //查看订单模态框
                <div class="modal fade" id="@string.Format("ModelB2{0}",item.OrderId).Trim()">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalTitle">订单信息</h5>
                                <button type="button" class="close" data-dismiss="modal">
                                    <span>&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div>订单名：@item.Name</div><br />
                                <div>下单人：@item.Users.UsersName</div><br />
                                <div>接单人：@item.Creator.Users.UsersName</div><br />
                                <div>金额：@item.total_amt</div><br />
                                <div>下单日期：@item.BuyDate</div><br />
                                <div>截止日期：@item.FinishDate</div><br />
                                <div>订单状态：@item.OrderState</div><br />
                                <div>具体描述：<br /><textarea rows="5" cols="45">@item.NeedDescrib</textarea></div>

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
        <div class="tab-pane fade" id="image3">
            @*待评论*@
            @foreach (var item in Model.UnComment_User_Orders)
            {
                <div class="row h-100 no-gutters border-bottom justify-content-between mt-2" style="height: 200px; ">
                    <div class="col-3">
                        <div class="img p-4" style="display:flex;position: center;">
                            <img src="~/image/PersonalSpace/图片三.jpg" width="100%" style="border-radius: 5%;">
                        </div>
                        <div class="text-center mt-n1 state">@item.OrderState</div>
                    </div>
                    <div class="col-6 py-3">
                        <p>@item.Name</p>
                        <div class="time" style="margin-bottom: 8px;">消费时间：@item.BuyDate</div>
                        <div class="time" style="margin-bottom:10px;">实际交付时间：@item.ActualFinishDate</div>
                        <span>@item.CreateType </span>&nbsp;&nbsp;
                        <span>接单人：@item.CreatorName</span><br>
                        <div class="mt-2"></div>
                        <button type="button" class="btn btn-info" data-toggle="modal" data-target="@string.Format("#ModelC1{0}",item.OrderId).Trim()">查看订单</button>
                        <button type="button" class="btn btn-info" data-toggle="modal" data-target="@string.Format("#ModelC2{0}",item.OrderId).Trim()">去评价</button>
                    </div>
                    <div class="col-2 py-4" style="color: red;">
                        ￥@item.total_amt
                    </div>
                </div>
                //查看订单模态框
                <div class="modal fade" id="@string.Format("ModelC1{0}",item.OrderId).Trim()">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalTitle">订单信息</h5>
                                <button type="button" class="close" data-dismiss="modal">
                                    <span>&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div>订单名：@item.Name</div><br />
                                <div>下单人：@item.UsersName</div><br />
                                <div>接单人：@item.CreatorName</div><br />
                                <div>金额：@item.total_amt ￥</div><br />
                                <div>下单日期：@item.BuyDate</div><br />
                                <div>截止日期：@item.FinishDate</div><br />
                                <div>订单状态：@item.OrderState</div><br />
                                <div>具体描述：<br /><textarea rows="5" cols="45">@item.NeedDescrib</textarea></div>

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                            </div>
                        </div>
                    </div>
                </div>

                //发布评价模态框
                <div class="modal fade" id="@string.Format("ModelC2{0}",item.OrderId).Trim()">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalTitle">发表评价</h5>
                                <button type="button" class="close" data-dismiss="modal">
                                    <span>&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div>一个订单只能评价一次哦，请认真填写！</div><br />
                                <form action="@Url.Action("SubmitEvaluate","OrderManage",new { id= item.CreatorId})" name="form2" method="post">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="orderid" value="@item.OrderId" />
                                    <textarea name="content" rows="5" cols="45" placeholder="请输入评价内容"></textarea>
                                    <br/>
                                    <button type="button" data-dismiss="modal">关闭</button>
                                    <button type="submit" formmethod="post">提交</button>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                            </div>
                        </div>
                    </div>
                </div>
            }

        </div>
        <div class="tab-pane fade" id="image4">
            @*进行中*@
            @foreach (var item in Model.UnFinished_User_Orders)
            {
                if (item.OrderState.Contains("待验收"))
                {
                    <div class="row h-100 no-gutters border-bottom justify-content-between mt-2" style="height: 200px; ">
                        <div class="col-3">
                            <div class="img p-4" style="display:flex;position: center;">
                                <img src="~/image/PersonalSpace/图片四.jpg" width="100%" style="border-radius: 5%;" />
                            </div>
                            <div class="text-center mt-n1 state">@item.OrderState</div>
                        </div>
                        <div class="col-6 py-3">
                            <p>@item.Name</p>
                            <div class="time" style="margin-bottom: 8px;">消费时间：@item.BuyDate</div>
                            <div class="time" style="margin-bottom:10px;">交付时间：@item.FinishDate</div>
                            <span>@item.Creator.CreateType</span>&nbsp;&nbsp;
                            <span>接单人：@item.Creator.Users.UsersName</span><br>
                            <div class="mt-2"></div>
                            <a type="button" data-toggle="modal" data-target="@string.Format("#ModelD1{0}",item.OrderId).Trim()" class="btn btn-info">发送消息</a>
                            <button type="button" data-toggle="modal" data-target="@string.Format("#ModelD2{0}",item.OrderId).Trim()" class="btn btn-info">查看订单</button>
                            <button data-toggle="modal" data-target="@string.Format("#ModelD3{0}",item.OrderId).Trim()" type="button" class="btn btn-info">申请退单</button>
                            <a href="@Url.Action("FinishOrder","OrderManage",new { id=item.OrderId})" type="button" class="btn btn-info">确认验收</a>
                        </div>
                        <div class="col-2 py-4" style="color: red;">
                            ￥@item.total_amt
                        </div>
                    </div>

                    //发送消息模态框  即私信模态框
                    <div class="modal fade" id="@string.Format("ModelD1{0}",item.OrderId).Trim()">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="modalTitle">私信</h5>
                                    <button type="button" class="close" data-dismiss="modal">
                                        <span>&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form action="@Url.Action("SendPersonalMessage","MessageManager",new { rid=item.UsersId})" name="form1" method="post">
                                        @Html.AntiForgeryToken()
                                        <textarea rows="5" cols="45" name="content" placeholder="请在此输入咨询内容"></textarea>
                                        <br />
                                        <button type="button" data-dismiss="modal">关闭</button>
                                        <button type="submit" formmethod="post">提交</button>
                                    </form>
                                </div>
                                <div class="modal-footer">

                                </div>
                            </div>
                        </div>
                    </div>

                    //查看订单模态框
                    <div class="modal fade" id="@string.Format("ModelD2{0}",item.OrderId).Trim()">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="modalTitle">订单信息</h5>
                                    <button type="button" class="close" data-dismiss="modal">
                                        <span>&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div>订单名：@item.Name</div><br />
                                    <div>下单人：@item.Users.UsersName</div><br />
                                    <div>接单人：@item.Creator.Users.UsersName</div><br />
                                    <div>金额：@item.total_amt</div><br />
                                    <div>下单日期：@item.BuyDate</div><br />
                                    <div>截止日期：@item.FinishDate</div><br />
                                    <div>订单状态：@item.OrderState</div><br />
                                    <div>具体描述：<br /><textarea rows="5" cols="45">@item.NeedDescrib</textarea></div>

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    //申请退单的模态框
                    <div class="modal fade" id="@string.Format("ModelD3{0}",item.OrderId).Trim()">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="modalTitle">请填写如下信息</h5>
                                    <button type="button" class="close" data-dismiss="modal">
                                        <span>&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    @using (Html.BeginForm("ApplyBackOrder", "OrderManage", new { name = "form3" }))
                                    {
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="orderid" value="@item.OrderId" />
                                        <p>请在下方输入你的理由(便于工作人员审核，请认真填写)</p><textarea rows="5" cols="45" name="content" placeholder="请在此输入您的需求"> </textarea>
                                        <br />

                                        <button type="button" data-dismiss="modal">关闭</button>
                                        <button type="submit" formmethod="post" onclick="if (confirm('是否确认申请退单？') == false) return false;">确认提交</button>
                                    }
                                </div>
                                <div class="modal-footer">

                                </div>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <div class="row h-100 no-gutters border-bottom justify-content-between mt-2" style="height: 200px; ">
                        <div class="col-3">
                            <div class="img p-4" style="display:flex;position: center;">
                                <img src="~/image/PersonalSpace/图片四.jpg" width="100%" style="border-radius: 5%;" />
                            </div>
                            <div class="text-center mt-n1 state">@item.OrderState</div>
                        </div>
                        <div class="col-6 py-3">
                            <p>@item.Name</p>
                            <div class="time" style="margin-bottom: 8px;">消费时间：@item.BuyDate</div>
                            <div class="time" style="margin-bottom:10px;">交付时间：@item.FinishDate</div>
                            <span>@item.Creator.CreateType</span>&nbsp;&nbsp;
                            <span>接单人：@item.Creator.Users.UsersName</span><br>
                            <div class="mt-2"></div>
                            <button type="button" data-toggle="modal" data-target="@string.Format("#ModelE1{0}",item.OrderId).Trim()" class="btn btn-info">发送消息</button>
                            <button type="button" data-toggle="modal" data-target="@string.Format("#ModelE2{0}",item.OrderId).Trim()" class="btn btn-info">查看订单</button>
                            <a href="@Url.Action("UrgenOrder","OrderManage",new { id=item.OrderId})" type="button" class="btn btn-info">催促订单</a>
                            <button data-toggle="modal" data-target="@string.Format("#ModelE4{0}",item.OrderId).Trim()" type="button" class="btn btn-info">申请退单</button>
                        </div>
                        <div class="col-2 py-4" style="color: red;">
                            ￥@item.total_amt
                        </div>
                    </div>
                    //发送消息模态框  即私信模态框
                    <div class="modal fade" id="@string.Format("ModelE1{0}",item.OrderId).Trim()">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="modalTitle">私信</h5>
                                    <button type="button" class="close" data-dismiss="modal">
                                        <span>&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form action="@Url.Action("SendPersonalMessage","MessageManager",new { rid=item.UsersId})" name="form1" method="post">
                                        @Html.AntiForgeryToken()
                                        <textarea rows="5" cols="45" name="content" placeholder="请在此输入咨询内容"></textarea>
                                        <br />
                                        <button type="button" data-dismiss="modal">关闭</button>
                                        <button type="submit" formmethod="post">提交</button>
                                    </form>
                                </div>
                                <div class="modal-footer">

                                </div>
                            </div>
                        </div>
                    </div>

                    //查看订单模态框
                    <div class="modal fade" id="@string.Format("ModelE2{0}",item.OrderId).Trim()">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="modalTitle">订单信息</h5>
                                    <button type="button" class="close" data-dismiss="modal">
                                        <span>&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div>订单名：@item.Name</div><br />
                                    <div>下单人：@item.Users.UsersName</div><br />
                                    <div>接单人：@item.Creator.Users.UsersName</div><br />
                                    <div>金额：@item.total_amt</div><br />
                                    <div>下单日期：@item.BuyDate</div><br />
                                    <div>截止日期：@item.FinishDate</div><br />
                                    <div>订单状态：@item.OrderState</div><br />
                                    <div>具体描述：<br /><textarea rows="5" cols="45">@item.NeedDescrib</textarea></div>

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    //申请退单的模态框
                    <div class="modal fade" id="@string.Format("ModelE4{0}",item.OrderId).Trim()">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="modalTitle">请填写如下信息</h5>
                                    <button type="button" class="close" data-dismiss="modal">
                                        <span>&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    @using (Html.BeginForm("ApplyBackOrder", "OrderManage", new { name = "form3" }))
                                    {
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="orderid" value="@item.OrderId" />
                                        <p>请在下方输入你的理由(便于工作人员审核，请认真填写)</p><textarea rows="5" cols="45" name="content" placeholder="请在此输入您的需求"> </textarea>
                                        <br />

                                        <button type="button" data-dismiss="modal">关闭</button>
                                        <button type="submit" formmethod="post">确认提交</button>
                                    }
                                </div>
                                <div class="modal-footer">

                                </div>
                            </div>
                        </div>
                    </div>
                }

            }
        </div>
    </div>
</body>
</html>

